<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <title>لعبة القطة الطائرة - 9 مراحل</title>
    <style>
        body { margin: 0; overflow: hidden; background: #222; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        canvas { display: block; background-color: #87CEEB; /* لون سماء */ }
        #ui {
            position: absolute; top: 10px; left: 10px;
            color: white; font-size: 20px; background: rgba(0,0,0,0.6); padding: 8px; border-radius: 5px;
            z-index: 100;
        }
        #stage-title {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            color: white; font-size: 60px; text-shadow: 3px 3px 5px rgba(0,0,0,0.7);
            z-index: 99; display: none; /* سيظهر عند بداية كل مرحلة */
        }
    </style>
</head>
<body>
    <div id="ui">
        المرحلة: <span id="currentStageDisplay">1</span> / 9<br>
        النقاط: <span id="scoreDisplay">0</span><br>
        الجوائز المتبقية: <span id="prizesRemainingDisplay">0</span>
    </div>
    <div id="stage-title">المرحلة 1</div>
    <canvas id="gameCanvas"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const currentStageDisplay = document.getElementById('currentStageDisplay');
        const scoreDisplay = document.getElementById('scoreDisplay');
        const prizesRemainingDisplay = document.getElementById('prizesRemainingDisplay');
        const stageTitleElement = document.getElementById('stage-title');

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        let gameRunning = false;
        let currentStage = 1;
        let score = 0;
        let player = { x: 50, y: canvas.height / 2, width: 60, height: 40, dy: 0, gravity: 0.5, jumpPower: -10, onGround: false };
        let prizes = [];
        let enemies = []; // تشمل النسر
        let platforms = []; // منصات للقفز عليها
        
        // صور (افتراضية - يمكنك استبدالها بمسارات صور حقيقية لديك)
        const catImg = new Image();
        catImg.src = 'https://i.imgur.com/kO8jXzI.png'; // رابط افتراضي لقطة
        const prizeImg = new Image();
        prizeImg.src = 'https://i.imgur.com/kO8jXzI.png'; // رابط افتراضي لجائزة (مثل نجمة)
        const couponImg = new Image();
        couponImg.src = 'https://i.imgur.com/kO8jXzI.png'; // رابط افتراضي لكوبون
        const eagleImg = new Image();
        eagleImg.src = 'https://i.imgur.com/kO8jXzI.png'; // رابط افتراضي لنسر

        let imagesLoaded = 0;
        const totalImages = 4; // عدد الصور التي يتم تحميلها

        function imageLoadHandler() {
            imagesLoaded++;
            if (imagesLoaded === totalImages) {
                console.log("All images loaded!");
                initStage(currentStage); // ابدأ اللعبة بعد تحميل الصور
                gameRunning = true; // ابدأ حلقة اللعبة
            }
        }

        catImg.onload = imageLoadHandler;
        prizeImg.onload = imageLoadHandler;
        couponImg.onload = imageLoadHandler;
        eagleImg.onload = imageLoadHandler;

        // دالة إنشاء المراحل
        function initStage(stageNum) {
            stageTitleElement.innerText = `المرحلة ${stageNum}`;
            stageTitleElement.style.display = 'block';
            setTimeout(() => stageTitleElement.style.display = 'none', 1500); // إخفاء العنوان بعد 1.5 ثانية

            player.x = 50;
            player.y = canvas.height / 2;
            player.dy = 0;
            prizes = [];
            enemies = [];
            platforms = [];
            scoreDisplay.innerText = score;
            currentStageDisplay.innerText = stageNum;

            const basePrizes = 3;
            const baseEnemies = 0;
            const basePlatforms = 1; // منصة البداية

            // إعدادات لكل مرحلة
            switch (stageNum) {
                case 1: // البداية: قطة وجوائز بسيطة
                    addPrizes(basePrizes);
                    addPlatforms(basePlatforms);
                    break;
                case 2: // تحدي السرعة: جوائز أكثر، حركة أسرع
                    addPrizes(basePrizes + 2);
                    player.gravity = 0.6;
                    player.jumpPower = -12;
                    addPlatforms(basePlatforms + 1);
                    break;
                case 3: // ظهور النسر: قطة، جوائز، يلاحقها نسر
                    addPrizes(basePrizes + 2);
                    addEnemies(baseEnemies + 1, 'eagle'); // نسر يطارد
                    addPlatforms(basePlatforms + 2);
                    break;
                case 4: // عوائق متحركة: نسر وأكثر من جائزة وكوبون
                    addPrizes(basePrizes + 3);
                    addCoupons(1);
                    addEnemies(baseEnemies + 1, 'moving'); // نسر يتحرك
                    addPlatforms(basePlatforms + 3);
                    break;
                case 5: // الجاذبية المتغيرة
                    addPrizes(basePrizes + 4);
                    addCoupons(2);
                    player.gravity = 0.8; // جاذبية أقوى
                    addEnemies(baseEnemies + 2, 'moving');
                    addPlatforms(basePlatforms + 4);
                    break;
                case 6: // المتاهة الخفيفة
                    addPrizes(basePrizes + 5);
                    addCoupons(3);
                    addEnemies(baseEnemies + 2, 'eagle');
                    // منصات معقدة أكثر
                    addPlatforms(basePlatforms + 5); 
                    break;
                case 7: // أعداء متعددون
                    addPrizes(basePrizes + 6);
                    addCoupons(4);
                    addEnemies(baseEnemies + 3, 'moving'); // أعداء أكثر
                    addEnemies(1, 'eagle'); // نسر إضافي
                    addPlatforms(basePlatforms + 6);
                    break;
                case 8: // السرعة القصوى والتحدي
                    addPrizes(basePrizes + 7);
                    addCoupons(5);
                    player.gravity = 1; // جاذبية قصوى
                    player.jumpPower = -15; // قفزة أعلى لتعويض الجاذبية
                    addEnemies(baseEnemies + 4, 'moving');
                    addEnemies(2, 'eagle');
                    addPlatforms(basePlatforms + 7);
                    break;
                case 9: // مرحلة الزعيم النهائي (النسر الأكبر)
                    addPrizes(basePrizes + 8);
                    addCoupons(6);
                    addEnemies(1, 'bossEagle'); // نسر زعيم أكبر وأسرع
                    addPlatforms(basePlatforms + 8);
                    break;
            }
            prizesRemainingDisplay.innerText = prizes.length;
        }

        function addPrizes(count) {
            for (let i = 0; i < count; i++) {