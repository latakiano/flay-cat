<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Himalayan Legend - Stage 3</title>
    <style>
        body { margin: 0; background: #001a33; overflow: hidden; touch-action: none; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        canvas { display: block; }
        #ui { position: absolute; top: 20px; width: 100%; text-align: center; color: white; pointer-events: none; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); }
        .distance-bar { width: 60%; height: 10px; background: rgba(255,255,255,0.2); margin: 10px auto; border-radius: 5px; overflow: hidden; }
        #fill { width: 0%; height: 100%; background: #ffffff; box-shadow: 0 0 10px #ffffff; }
    </style>
</head>
<body>

<div id="ui">
    <div style="font-size: 24px; font-weight: bold;">Ø¬Ø¨Ø§Ù„ Ø§Ù„Ù†Ø³ÙˆØ± ğŸ”ï¸</div>
    <div class="distance-bar"><div id="fill"></div></div>
    <div style="font-size: 16px;">Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©: <span id="dist">1000</span>m</div>
</div>

<canvas id="G"></canvas>

<script>
    const cvs = document.getElementById('G');
    const c = cvs.getContext('2d');

    function res() { cvs.width = window.innerWidth; cvs.height = window.innerHeight; }
    window.addEventListener('resize', res); res();

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ± Ø¨Ø§Ø­ØªØ±Ø§ÙÙŠØ©
    const assets = {
        cat: 'https://img.icons8.com/color/96/cat--v1.png',
        eagle: 'https://img.icons8.com/color/150/eagle.png',
        fish: 'https://img.icons8.com/color/48/fish.png'
    };
    const imgs = {};
    for(let k in assets) { imgs[k] = new Image(); imgs[k].src = assets[k]; }

    let py = cvs.height / 2, pv = 0; 
    let ex = -120, ey = cvs.height / 2; 
    let obstacles = [];
    let distance = 1000;
    let score = 0;

    function draw() {
        // Ø±Ø³Ù… Ø§Ù„Ø®Ù„ÙÙŠØ© (ØªØ¯Ø±Ø¬ Ù„ÙˆÙ†ÙŠ ÙŠÙ…Ø«Ù„ Ø¬Ø¨Ø§Ù„ Ø§Ù„Ù†Ø³ÙˆØ±)
        let grad = c.createLinearGradient(0, 0, 0, cvs.height);
        grad.addColorStop(0, '#001a33');
        grad.addColorStop(1, '#003366');
        c.fillStyle = grad;
        c.fillRect(0, 0, cvs.width, cvs.height);

        // Ù…Ù†Ø·Ù‚ Ø§Ù„Ø­Ø±ÙƒØ©
        pv += 0.48; 
        py += pv;
        distance -= 0.5;

        // Ø­Ø±ÙƒØ© Ø§Ù„Ù†Ø³Ø± Ø§Ù„Ø°ÙƒÙŠØ©
        ey += (py - 60 - ey) * 0.08;
        ex = Math.min(60, ex + 0.4);

        // ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø¹Ù‚Ø¨Ø§Øª (Ø£Ø¹Ù…Ø¯Ø© Ø¨ÙŠØ¶Ø§Ø¡ Ø«Ù„Ø¬ÙŠØ©)
        if (obstacles.length === 0 || obstacles[obstacles.length - 1].x < cvs.width - 340) {
            obstacles.push({ x: cvs.width, h: Math.random() * (cvs.height - 320) + 60, w: 55 });
        }

        // Ø±Ø³Ù… Ø§Ù„Ø¹Ù‚Ø¨Ø§Øª ÙˆØ§Ù„ØªØµØ§Ø¯Ù…
        c.fillStyle = "rgba(255, 255, 255, 0.9)";
        for (let i = obstacles.length - 1; i >= 0; i--) {
            let o = obstacles[i];
            o.x -= 7;
            
            c.fillRect(o.x, 0, o.w, o.h); // Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø¹Ù„ÙˆÙŠ
            c.fillRect(o.x, o.h + 260, o.w, cvs.height); // Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø³ÙÙ„ÙŠ

            // ØªØµØ§Ø¯Ù… Ø¯Ù‚ÙŠÙ‚
            if (100 > o.x && 55 < o.x + o.w && (py < o.h || py + 40 > o.h + 260)) reset();
            if (o.x < -100) obstacles.splice(i, 1);
        }

        // Ø±Ø³Ù… Ø§Ù„Ù†Ø³Ø± ÙˆØ§Ù„Ù‚Ø·Ø©
        c.drawImage(imgs.eagle, ex, ey, 110, 110);
        c.drawImage(imgs.cat, 55, py, 50, 50);

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
        document.getElementById('dist').innerText = Math.max(0, Math.floor(distance));
        document.getElementById('fill').style.width = (1 - (distance/1000))*100 + "%";

        // Ø´Ø±ÙˆØ· Ø§Ù„Ø®Ø³Ø§Ø±Ø©
        if (py > cvs.height || py < 0 || 55 < ex + 40) reset();

        requestAnimationFrame(draw);
    }

    function reset() {
        py = cvs.height / 2; pv = 0; ex = -120; ey = cvs.height / 2;
        obstacles = []; distance = 1000;
    }

    // Ø§Ù„Ù‚ÙØ² (Ø¯Ø¹Ù… ÙƒØ§Ù…Ù„ Ù„Ù„Ù…Ø³ ÙˆØ§Ù„Ù…Ø§ÙˆØ³)
    const jump = (e) => { pv = -8.5; if(e.cancelable) e.preventDefault(); };
    window.addEventListener('mousedown', jump);
    window.addEventListener('touchstart', jump, { passive: false });

    draw();
</script>
</body>
</html>