<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Eagle Level - Logic Test</title>
    <style>
        body { margin: 0; background: #001a33; overflow: hidden; touch-action: none; font-family: sans-serif; }
        canvas { display: block; background: #001a33; }
        #overlay { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.9); display: flex; flex-direction: column; 
            justify-content: center; align-items: center; color: white; z-index: 100; 
        }
        button { 
            padding: 25px 60px; font-size: 30px; cursor: pointer; border-radius: 20px; 
            border: none; background: #27ae60; color: white; font-weight: bold;
        }
    </style>
</head>
<body>

<div id="overlay">
    <h1 id="status">اختبار المحرك ⚙️</h1>
    <button id="startBtn">ابدأ الاختبار الآن</button>
</div>

<canvas id="gameCanvas"></canvas>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const overlay = document.getElementById('overlay');
    const startBtn = document.getElementById('startBtn');

    function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
    window.addEventListener('resize', resize); resize();

    let gameActive = false;
    let p = { x: 80, y: 0, v: 0 }; // القطة (ستظهر كمربع برتقالي)
    let e = { x: -100, y: 0 };     // النسر (سيظهر كمربع أحمر)
    let obs = [];

    startBtn.onclick = function() {
        overlay.style.display = 'none';
        p.y = canvas.height / 2;
        e.y = canvas.height / 2;
        p.v = 0;
        obs = [];
        gameActive = true;
    };

    function update() {
        if (!gameActive) return;

        // 1. مسح الشاشة
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // 2. الجاذبية
        p.v += 0.5;
        p.y += p.v;

        // 3. النسر (يلاحق القطة)
        e.y += (p.y - e.y) * 0.05;
        e.x = Math.min(p.x - 80, e.x + 0.5);

        // 4. الحواجز (بيضاء)
        if (obs.length === 0 || obs[obs.length - 1].x < canvas.width - 350) {
            obs.push({ x: canvas.width, t: Math.random() * (canvas.height - 300) + 50, g: 250 });
        }

        ctx.fillStyle = "white";
        for (let i = obs.length - 1; i >= 0; i--) {
            let o = obs[i];
            o.x -= 7;
            // رسم الحواجز
            ctx.fillRect(o.x, 0, 60, o.t);
            ctx.fillRect(o.x, o.t + o.g, 60, canvas.height);

            // تصادم مع الحواجز
            if (p.x + 40 > o.x && p.x < o.x + 60 && (p.y < o.t || p.y + 40 > o.t + o.g)) {
                gameActive = false; location.reload();
            }
            if (o.x < -100) obs.splice(i, 1);
        }

        // 5. الموت (نسر أو سقوط)
        if (p.y > canvas.height || p.y < 0 || p.x < e.x + 40) {
            gameActive = false; location.reload();
        }

        // 6. رسم "القطة" (مربع برتقالي)
        ctx.fillStyle = "#ff9800";
        ctx.fillRect(p.x, p.y, 40, 40);

        // 7. رسم "النسر" (مربع أحمر)
        ctx.fillStyle = "#ff0000";
        ctx.fillRect(e.x, e.y, 60, 60);

        requestAnimationFrame(update);
    }

    // القفز
    function jump() { if (gameActive) p.v = -9; }
    window.addEventListener('mousedown', jump);
    window.addEventListener('touchstart', (ev) => { ev.preventDefault(); jump(); }, {passive: false});

    update(); // تشغيل حلقة الرسم
</script>
</body>
</html>